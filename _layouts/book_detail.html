{% extends 'base.html' %}

{% set meta = book %}

{% block content %}
<nav class="nav">
  <p><a href="/">e.e. cummings free poetry archive</a></p>
  <div class="break small"></div>
</nav>
<article>
<header class="book">
  <h1>{{ book.title }}</h1>
</header>
<section class="intro">
  <p>
    {{ book.description }}
    {% if book.public_domain == false %}Until then, it remains protected by copyright and cannot be republished here.{% endif %}
  </p>
  {% if book.public_domain == true and (availablePoems|length) > 0 and (availablePoems.length < allPoems.length) %}
  <p>
    Thus far, {{ availablePoems|length|apnumber }} of the book's {{ allPoems|length|apnumber }} poems have been digitized.
    {# <a href="">Here's how</a> you can get involved in adding more. #}
  </p>
  {% endif %}
</section>
{% if book.public_domain == true and (availablePoems|length) > 0 %}
<section class="toc">
  <h2>Table of contents</h2>
  <ol class="level1">
  {% for level1 in toc[book.slug] %}
    <li>{{ level1.name }}</li>
    <ol class="level2">
    {% for level2 in level1.children %}
      {% if level2.children %}
      <li data-public-domain="{% if poems[book.slug][(level2.children|first).slug] %}true{% else %}false{% endif %}">
        {{ level2.name }} ({% for level3 in level2.children %}{% if poems[book.slug][level3.slug] %}<a href="/book/{{ book.slug }}/poem/{{ level3.slug }}/">{{ level3.name }}</a>{% else %}{{ level3.name }}{% endif %}{% if not loop.last %}, {% endif %}{% endfor %})
      </li>
      {% else %}
      <li data-public-domain="{% if poems[book.slug][level2.slug] %}true{% else %}false{% endif %}">
        {% if poems[book.slug][level2.slug] %}
          <a href="/book/{{ book.slug }}/poem/{{ level2.slug }}/">{{ level2.name }}</a>
        {% else %}
          {{ level2.name }}
        {% endif %}
      </li>
      {% endif %}
    {% endfor %}
    </ol>
  {% endfor %}
  </ol>
</section>
{% endif %}
</article>
{% endblock content %}

{% block footer -%}
<footer class="footer">
  <div class="break footer"></div>
  {% if book.source %}
    <p>{{ book.source }}</p>
  {% endif %}
   <p>The table of contents is also available in <a href="{{ book.json_url }}">json</a> format.</p>
  <p>{{ footer.copy }}</p>
</footer>
{% endblock footer -%}
